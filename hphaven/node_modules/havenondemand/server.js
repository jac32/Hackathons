//Lets require/import the HTTP module
var http = require('http');

var hod = require('./lib/hodneedle')
module.exports=hod
var client = new hod.HODClient('41885913-8861-4edc-8b4f-878982647379', 'v1')

//Lets define a port we want to listen to
const PORT=8080;

//We need a function which handles requests and send response
function handleRequest(request, response){
  console.log("Received request");

  response.writeHead(200, {
      'Content-Type': 'text/plain',
      'Access-Control-Allow-Origin' : '*',
      'Access-Control-Allow-Methods': 'GET,PUT,POST,DELETE'
  });

  var input = "";
  request.on('data', function(chunk) {
      input = chunk.toString();
      console.log("Client called: " + input);
      input = input.replace('text=', '');
      for(var i = input.length; i>0; i--)
        input = input.replace('+', ' ');
      client.call('analyzesentiment', {text: input}, function(err, resp, body){
        var sentiment = body.aggregate.sentiment;
        var score = body.aggregate.score;
        console.log(input + "|" + sentiment + "|" + score);
        response.end("score:" + score);
      });
  });
}

//Create a server
var server = http.createServer(handleRequest);

//Lets start our server
server.listen(PORT, function(){
    //Callback triggered when server is successfully listening. Hurray!
    console.log("Server listening on: http://localhost:%s", PORT);
});


var text = "I am not interesting"

client.call('analyzesentiment', {text: text}, function(err, resp, body){
  var sentiment = body.aggregate.sentiment;
  var score = body.aggregate.score;
  console.log(text + "|" + sentiment + "|" + score);
});
